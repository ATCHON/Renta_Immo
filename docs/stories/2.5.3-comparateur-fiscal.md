# Story 2.5.3: Comparaison des Régimes Fiscaux

Status: ready-for-dev

<!-- Note: Validation is optional. Run validate-create-story for quality check before dev-story. -->

## Story

**As an** investisseur immobilier,
**I want** comparer instantanément l'impact de différents régimes fiscaux (LMNP Réel, Micro-BIC, SCI IS, etc.) sur le même bien,
**so that** je puisse choisir la stratégie la plus rentable et optimiser mon cashflow net.

## Acceptance Criteria

1. [ ] **Affichage d'un tableau comparatif** des 5 régimes principaux côte à côte :
    - Location nue (Micro-foncier)
    - Location nue (Foncier réel)
    - LMNP (Micro-BIC)
    - LMNP (Réel)
    - SCI à l'IS
2. [ ] **Comparaison sur indicateurs clés** :
    - Impôt moyen annuel (sur 10 ans)
    - Cashflow net annuel moyen
    - Rentabilité nette-nette
3. [ ] **Mise en évidence du régime optimal** via un badge "Conseillé" ou "Optimal" basé sur le meilleur cashflow net.
4. [ ] **Tooltips pédagogiques** expliquant brièvement les avantages/inconvénients de chaque régime.
5. [ ] **Intégration responsive** : le tableau doit être lisible sur mobile (scroll horizontal ou empilement).

## Tasks / Subtasks

- [ ] **Task 1: Orchestration des calculs fiscaux** (AC: 1, 2)
  - [ ] Modifier `src/server/calculations/index.ts` pour calculer tous les régimes en une passe ou créer un helper dédié.
  - [ ] S'assurer que les données pour les 5 régimes sont renvoyées par l'API dans un nouvel objet `comparaisons`.
- [ ] **Task 2: Création du composant FiscalComparator** (AC: 1, 3, 5)
  - [ ] Créer `src/components/results/FiscalComparator.tsx`.
  - [ ] Implémenter le rendu tabulaire avec badges pour le régime optimal.
- [ ] **Task 3: Ajout de l'aide pédagogique** (AC: 4)
  - [ ] Définir les textes d'aide pour chaque régime (ex: "Idéal si charges < 30%" pour le Micro-foncier).
  - [ ] Intégrer des tooltips (utiliser le composant UI existant).

## Dev Notes

### Architecture Patterns
- **Calculs Pures** : Utiliser les fonctions existantes dans `src/server/calculations/fiscalite.ts` (`calculerMicroFoncier`, `calculerFoncierReel`, `calculerLmnpReel`, etc.).
- **Compatibilité API** : Ajouter le champ `fiscaliteComparaison` dans le type `CalculResultats` dans `src/server/calculations/types.ts`.
- **Styling** : Utiliser Tailwind CSS et les patterns de design "Nordic Minimal" déjà établis (couleurs douces, bordures fines).

### Source Tree Components
- Logic : `src/server/calculations/fiscalite.ts`, `src/server/calculations/index.ts`, `src/server/calculations/types.ts`.
- UI : `src/components/results/FiscalComparator.tsx`, `src/app/page.tsx` (pour l'insertion).

### Testing Standards
- Unité : Tester l'orchestrateur de comparaison pour vérifier que les 5 régimes sont bien calculés.
- UI : Vérifier le responsive sur mobile.

### References
- [Architecture: Section 6.1.4 Fiscalité](file:///d:/Devs/Renta_Immo/docs/architecture.md#L289-302)
- [Spécification Calculs: Section Fiscalité](file:///d:/Devs/Renta_Immo/docs/specification-calculs.md)

## Dev Agent Record

### Agent Model Used
Antigravity (Google Deepmind)

### Debug Log References
- Extraction des besoins depuis `docs/stories/S5.3.comparaison-regimes-fiscaux.md`.
- Validation de la disponibilité des fonctions de calcul dans `src/server/calculations/fiscalite.ts`.

### Completion Notes List
- Comprehensive developer guide created.
- Links to architecture and specifications included.

### File List
- `d:/Devs/Renta_Immo/_bmad-output/implementation-artifacts/2.5.3-comparateur-fiscal.md`
