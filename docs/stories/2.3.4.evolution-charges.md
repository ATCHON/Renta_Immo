# Story 2.3.4: Évolution des Charges

## Status

✅ Done

---

## Story

**As a** investisseur immobilier,
**I want** projeter l'évolution de mes charges avec un taux d'inflation paramétrable,
**so that** je puisse anticiper mes dépenses futures et avoir des projections réalistes.

---

## Acceptance Criteria

1. [x] Champ "Taux d'inflation charges" dans le formulaire (section Options)
2. [x] Valeur par défaut : 2.5% (configurable dans les constantes)
3. [x] Application annuelle automatique sur toutes les charges dans les projections
4. [x] Mensualité crédit NON impactée (reste fixe sur toute la durée)
5. [x] Affichage des charges projetées année par année dans le tableau de projection
6. [x] Validation : taux entre 0% et 15%
7. [x] Distinction visuelle entre charges fixes (évoluent) et crédit (fixe)

---

## Tasks / Subtasks

- [x] **Task 1: Vérifier la constante par défaut** (AC: 2)
  - [x] `PROJECTION.INFLATION_CHARGES: 0.025` présent dans `constants.ts`.

- [x] **Task 2: Ajouter le champ au schéma de validation** (AC: 1, 6)
  - [x] `taux_evolution_charges` ajouté dans `validation.ts`.

- [x] **Task 3: Appliquer dans les projections** (AC: 3, 4)
  - [x] Logique implémentée dans `projection.ts`. Le crédit reste fixe tandis que les charges d'exploitation augmentent.

- [x] **Task 4: Ajouter le champ dans le formulaire** (AC: 1)
  - [x] Champ ajouté dans `StepOptions.tsx`.

- [x] **Task 5: Détailler les charges dans les projections** (AC: 5, 7)
  - [x] `ProjectionAnnuelle` contient `chargesExploitation` et `remboursementCredit`.

- [x] **Task 6: Afficher dans les résultats**
  - [x] `ProjectionTable.tsx` affiche les deux colonnes séparées ou détaille le coût.

- [x] **Task 7: Tests**
  - [x] Vérification de l'augmentation des charges vs fixité de l'échéance crédit.

---

## Dev Notes

### Distinction charges vs crédit

Les charges d'exploitation (Copro, taxes, assurances) subissent l'inflation. La mensualité de crédit (principal + intérêts + assurance emprunteur) reste constante, ce qui améliore le cashflow réel au fil du temps si le loyer suit aussi l'inflation.

---

## Testing

### Emplacement des tests
- `src/server/calculations/projection.test.ts` (Validé)

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-27 | 1.0 | Création de la story | John (PM) |
| 2026-01-27 | 1.1 | Validation checklist - Approved | Bob (SM) |
| 2026-01-28 | 1.2 | Implémentation complétée | Antigravity |

---

## Dev Agent Record

### Agent Model Used
Antigravity (Google Deepmind)

### Debug Log References
- Logic in `src/server/calculations/projection.ts`

### Completion Notes List
- Support for separate inflation rates for rent and charges
- Credit installments remain fixed in projections
- Clear distinction in the UI data table

### File List
- `src/server/calculations/projection.ts`
- `src/components/results/ProjectionTable.tsx`
- `src/components/form/steps/StepOptions.tsx`

---

## QA Results
Verified: Charges year 20 = Initial * (1 + 0.025)^20. Credit year 20 = Credit year 1.
