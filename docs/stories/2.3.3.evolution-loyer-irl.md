# Story 2.3.3: Évolution Loyer (IRL) ✅ Done

## Status

✅ Done

---

## Story

**As a** investisseur immobilier,
**I want** projeter l'évolution de mes loyers avec un taux d'indexation paramétrable,
**so that** je puisse anticiper mes revenus futurs et avoir des projections réalistes.

---

## Acceptance Criteria

1. [x] Champ "Taux d'évolution loyer" dans le formulaire (section Options)
2. [x] Valeur par défaut : 2% (configurable dans les constantes)
3. [x] Application annuelle automatique dans les projections
4. [x] Affichage du loyer projeté année par année dans le tableau de projection
5. [x] Tooltip explicatif mentionnant l'IRL (Indice de Référence des Loyers)
6. [x] Validation : taux entre 0% et 10%

---

## Tasks / Subtasks

- [x] **Task 1: Ajouter la constante par défaut** (AC: 2)
  - [x] Dans `src/config/constants.ts`, `PROJECTION.INFLATION_LOYER` est présent (0.02).

- [x] **Task 2: Ajouter le champ au schéma de validation** (AC: 1, 6)
  - [x] Dans `src/server/calculations/validation.ts`, ajout de `taux_evolution_loyer`.

- [x] **Task 3: Utiliser dans les projections** (AC: 3, 4)
  - [x] Dans `src/server/calculations/projection.ts`, application du taux sur `loyerMensuel`.

- [x] **Task 4: Ajouter le champ dans le formulaire** (AC: 1, 5)
  - [x] Champ `NumberInput` ajouté dans "Options" avec tooltip.

- [x] **Task 5: Afficher dans les résultats**
  - [x] Colonne "Loyer annuel" affichée dans le tableau de projection.

- [x] **Task 6: Tests**
  - [x] Validation des calculs exponentiels : `loyerInitial * (1 + taux)^n`.

---

## Dev Notes

### Intégration

Le taux est passé via l'objet `options` du formulaire. Par défaut, il utilise la valeur des constantes si le champ est vide.

---

## Testing

### Emplacement des tests
- `src/server/calculations/projection.test.ts` (Validé)

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-27 | 1.0 | Création de la story | John (PM) |
| 2026-01-27 | 1.1 | Validation checklist - Approved | Bob (SM) |
| 2026-01-28 | 1.2 | Implémentation complétée | Antigravity |

---

## Dev Agent Record

### Agent Model Used
Antigravity (Google Deepmind)

### Debug Log References
- Evolution logic in `src/server/calculations/projection.ts`

### Completion Notes List
- Support for customizable IRL rate
- Automatic compounding calculation
- Form integration in `StepOptions.tsx`

### File List
- `src/config/constants.ts`
- `src/server/calculations/projection.ts`
- `src/server/calculations/validation.ts`
- `src/components/form/steps/StepOptions.tsx`

---

## QA Results
Formula: Loyer_Annuel = Loyer_Mensuel * 12 * (1 + inflation)^annee. Verified for years 1, 5, 20.
