# Story 2.6.1: Gestion de plusieurs scénarios (Mémoire vive)

Status: done

## Story

**As an** investisseur immobilier,
**I want** tester différentes variations d'un même projet (prix, taux, travaux) sans perdre les simulations précédentes,
**so that** je puisse comparer les résultats et affiner ma stratégie d'investissement.

## Acceptance Criteria

1. [x] **Multi-scénarios** : Possibilité de gérer jusqu'à 3 scénarios simultanément.
2. [x] **Action "Dupliquer"** : Pouvoir créer une copie d'un scénario existant pour tester une variante.
3. [x] **Navigation fluide** : Alterner entre les scénarios via des onglets (Tabs) sur la page de résultats.
4. [x] **Nommage** : Chaque scénario peut être renommé (ex: "Scénario A", "Négociation -10%").
5. [x] **Isolation des données** : Les modifications dans le formulaire ne s'appliquent qu'au scénario actif.
6. [x] **Volatilité** : Les données sont conservées dans le state Zustand mais ne sont pas persistées en DB/LocalStorage (hors scope).

## Tasks / Subtasks

- [x] **Task 1: Adaptation du Zustand Store** (AC: 1, 5, 6)
  - [x] Modifier `src/stores/calculateur.store.ts` pour stocker une liste de scénarios au lieu d'un objet unique.
  - [x] Ajouter `activeScenarioId` pour suivre le scénario en cours d'édition.
  - [x] Mettre à jour les setters pour qu'ils ciblent le scénario actif.
- [x] **Task 2: UI de gestion des scénarios** (AC: 2, 3, 4)
  - [x] Ajouter un composant `ScenarioTabs` dans le header ou au-dessus des résultats.
  - [x] Implémenter le bouton "Ajouter/Dupliquer" et l'option "Renommer".
  - [x] Gérer la suppression d'un scénario (avec confirmation).

## Dev Notes

### Architecture Patterns
- **Store Zustand** : Utiliser un tableau `scenarios: ScenarioData[]`. Chaque `ScenarioData` contient `bien`, `financement`, etc.
- **Hooks** : S'assurer que `useCalculateur` et les hooks associés pointent vers le scénario sélectionné.
- **Performance** : Le calcul API doit être déclenché pour le scénario actif lors de la navigation ou de la modification.

### Source Tree Components
- Logic : `src/stores/calculateur.store.ts`.
- UI : `src/components/layout/Header.tsx` (ou nouveau composant), `src/components/results/Dashboard.tsx`.

### Testing Standards
- État : Vérifier que passer du Scénario 1 au Scénario 2 ne mélange pas les données.
- Limite : Empêcher la création de plus de 3 scénarios.

### References
- [PRD: Section 2.1 FR20](file:///d:/Devs/Renta_Immo/docs/prd.md#L78)
- [Architecture: Section 4.2 Sequence Diagram](file:///d:/Devs/Renta_Immo/docs/architecture.md#L164)

## Dev Agent Record

### Agent Model Used
James (Antigravity Persona)

### Debug Log References
- Store refactored to support `Scenario[]`.
- Fixed multiple build errors in form steps using `getActiveScenario()`.
- Successfully ran `npm run build`.

### Completion Notes List
- Multi-scenario logic implemented in Zustand.
- Isolation verified between tabs.
- Added `uuid` dependency for unique scenario IDs.
- UX: Tabs integrated in both Form and Results views.

### File List
- `src/stores/calculateur.store.ts`
- `src/types/calculateur.ts`
- `src/components/results/ScenarioTabs.tsx`
- `src/components/results/Dashboard.tsx`
- `src/components/forms/FormWizard.tsx` (and all Step components)

### Change Log
- 2026-01-30: Initial implementation of multi-scenario logic and UI.
